<div class="chat-container d-flex flex-column" style="height: 100vh;">
    <!-- ğŸ”· Logo + User Profile with Dropdown -->
    <div class="d-flex align-items-center justify-content-between p-2 border-bottom bg-light position-relative">

        <!-- ğŸ”¹ Left: Logo -->
        <div class="d-flex align-items-center">
            <img src="assets/chat.png" alt="Logo" width="40" height="40" class="me-2" />
            <span class="fw-bold fs-5">QuickChat</span>
        </div>

        <!-- ğŸ”¹ Right: User Profile -->
        <div class="user-profile d-flex align-items-center" (click)="toggleDropdown()" style="cursor: pointer;">
            <div class="text-end me-3">
                <div class="fw-bold">{{ userProfile?.userName }}</div>
                <div class="text-muted small">{{ userProfile?.email }}</div>
            </div>
            <div class="profile-icon bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px;">
                {{ userProfile?.userName ? userProfile.userName.charAt(0).toUpperCase() : 'X' }}
            </div>

            <!-- Dropdown -->
            <div class="dropdown-menu show" *ngIf="showDropdown"
                style="position: absolute; top: 100%; right: 0; z-index: 999;">
                <a class="dropdown-item" (click)="goToProfile()">ğŸ§‘â€ğŸ’¼ Profile</a>
                <a class="dropdown-item" (click)="goToSettings()">âš™ï¸ Settings</a>
                <a class="dropdown-item" (click)="toggleTheme()">ğŸŒ™ Dark Mode</a>
                <a class="dropdown-item" (click)="changePassword()">ğŸ”’ Change Password</a>
                <!-- <a class="dropdown-item" (click)="viewPolicies()">ğŸ“„ Policies</a>
                <a class="dropdown-item" (click)="openHelp()">â“ Help</a> -->
                <a class="dropdown-item" (click)="logout()">ğŸšª Logout</a>

            </div>
        </div>
    </div>

    <!-- ğŸ”¸ Main Chat Body -->
    <div class="d-flex flex-grow-1 overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar p-3 border-end" style="width: 250px; overflow-y: auto;">
            <h5 class="mb-2">Groups</h5>
            <ul class="list-group mb-4">
                <li class="list-group-item list-group-item-action" *ngFor="let group of groups"
                    (click)="selectChat(group.id, true)" [class.active]="selectedChat === group.id">
                    {{ group.name }}
                </li>
            </ul>

            <h5 class="mb-2">Users</h5>
            <ul class="list-group">
                <li class="list-group-item list-group-item-action" *ngFor="let user of users"
                    (click)="selectChat(user.id, false)" [class.active]="selectedChat === user.id">
                    {{ user.userName }}
                </li>
            </ul>
        </div>

        <!-- Chat area -->
        <div class="chat-area d-flex flex-column flex-grow-1 p-3">
            <ng-container *ngIf="selectedChat; else placeholder">
                <h4 class="border-bottom pb-2 mb-3">
                    Chat with <span style="text-transform: uppercase; font-style: italic; color: darkcyan;">[{{
                        selectedChatName }}]</span>
                </h4>

                <div #scrollMe class="flex-grow-1 overflow-auto mb-3">
                    <div *ngFor="let msg of messages" class="mb-2">
                        <div class="chat-bubble" [ngClass]="{
                            'me': msg.senderId === loginUserId,
                            'other': msg.senderId !== loginUserId
                            }">
                            {{ msg.text }}
                        </div>
                        <small class="text-muted d-block" [ngClass]="{ 'text-end': msg.senderId === loginUserId }">
                            {{ msg.sentAt | date: 'shortTime' }}
                        </small>
                    </div>
                </div>

                <div class="input-group">
                    <input type="text" [(ngModel)]="messageInput" (keyup.enter)="sendMessage()"
                        placeholder="Type a message..." class="form-control" />
                    <button class="btn btn-primary" (click)="sendMessage()">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
            </ng-container>

            <ng-template #placeholder>
                <div class="text-center text-muted mt-5">
                    <p>Select a user or group to start chatting.</p>
                </div>
            </ng-template>
        </div>
    </div>
</div>